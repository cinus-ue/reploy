Target root@105.239.136.127:22

Set V2RAY_VERSION "v4.28.2"
Set USER_HOME = "/home/cinus/"
Set INSTALL_PATH "/home/cinus/v2ray"

Task {
    Run "rm -rf ${INSTALL_PATH}"

    Say "Downloading V2Ray"
    Run "wget -P ${USER_HOME} \
    https://github.com/v2ray/v2ray-core/releases/download/${V2RAY_VERSION}/v2ray-linux-64.zip"
    When exit_code != "0" Goto DOWNLOAD_FAILED

    Run "mkdir ${INSTALL_PATH}"

    Say "File decompression"
    Run "mv ${USER_HOME}/v2ray-linux-64.zip ${INSTALL_PATH}"
    Run "unzip ${INSTALL_PATH}/v2ray-linux-64.zip -d ${INSTALL_PATH}" When exit_code != "0" Goto DECOMPRESSION_FAILED

    Run "rm -f ${INSTALL_PATH}/config.json"
    Snd "./config.json"  "${INSTALL_PATH}/config.json"

    Run "mkdir ${INSTALL_PATH}/log"

    Say "Starting V2Ray "
    Snd "./start.sh" "${INSTALL_PATH}/start.sh"
    Run "chmod +x ${INSTALL_PATH}/start.sh"
    Run "sh ${INSTALL_PATH}/start.sh" When exit_code != "0" Goto START_FAILED

    Say "Task finished"
}

Label DOWNLOAD_FAILED {
    Say "Download failed! Please check your network or try again."
    End
}

Label DECOMPRESSION_FAILED {
    Say "V2Ray decompression failed."
    End
}

Label START_FAILED {
    Say "Failed to start V2Ray service."
    End
}
